{% extends "base.html" %}
{% block body %}
<div class="max-w-6xl mx-auto py-6 text-gray-100">
  <div class="flex items-center justify-between mb-4">
    <h1 class="text-2xl font-semibold">Estoque</h1>
    <form method="get" class="flex items-center gap-2 text-sm">
      <input type="text" name="q" placeholder="Buscar por nome ou SKU..."
             value="{{ q }}"
             class="rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs w-56">
      <button type="submit"
              class="px-3 py-1 rounded-xl bg-red-500 hover:bg-red-600 text-xs font-semibold">
        Buscar
      </button>
    </form>
  </div>

  <!-- Form de novo item -->
  <div class="rounded-2xl bg-black/40 border border-zinc-800 p-4 mb-6 text-sm">
    <h2 class="text-sm font-semibold mb-3">Adicionar item ao estoque</h2>
    <form method="post" class="grid grid-cols-1 md:grid-cols-6 gap-3">
      <div class="md:col-span-2">
        <label class="block text-xs text-gray-400">Nome da peça / serviço</label>
        <input type="text" name="name" required
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs">
      </div>
      <div>
        <label class="block text-xs text-gray-400">SKU / Código</label>
        <input type="text" name="sku"
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs uppercase">
      </div>
      <div>
        <label class="block text-xs text-gray-400">Estoque atual</label>
        <input type="number" step="1" name="stock" value="0"
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs">
      </div>
      <div>
        <label class="block text-xs text-gray-400">Estoque mínimo</label>
        <input type="number" step="1" name="min_stock" value="0"
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs">
      </div>
      <div>
        <label class="block text-xs text-gray-400">Preço de venda (R$)</label>
        <input type="number" step="0.01" name="price" value="0"
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs">
      </div>
      <div>
        <label class="block text-xs text-gray-400">Custo (quanto você paga) (R$)</label>
        <input type="number" step="0.01" name="cost_price" value="0"
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs">
      </div>
      <div>
        <label class="block text-xs text-gray-400">Valor de repasse (R$)</label>
        <input type="number" step="0.01" name="repasse_value" value="0"
               class="w-full rounded-xl bg-black/40 border border-zinc-700 px-3 py-1 text-xs">
      </div>
      <div class="flex items-center gap-2 mt-4">
        <input type="hidden" name="is_labor" value="0">
        <input id="is_labor" type="checkbox" value="1" name="is_labor"
               class="rounded border-zinc-600 bg-black/40">
        <label for="is_labor" class="text-xs text-gray-300">
          Este item é mão de obra (serviço)
        </label>
      </div>
      <div class="md:col-span-6 flex justify-end mt-2">
        <button type="submit"
                class="px-4 py-1.5 rounded-xl bg-emerald-500 hover:bg-emerald-600 text-xs font-semibold">
          Salvar item
        </button>
      </div>
    </form>
  </div>

  <!-- Tabela -->
  <div class="rounded-2xl bg-black/40 border border-zinc-800 overflow-hidden">
    <div class="px-4 py-3 border-b border-zinc-800 flex items-center justify-between text-sm">
      <span class="font-semibold">Itens cadastrados</span>
      <span class="text-xs text-gray-400">{{ rows|length }} itens listados</span>
    </div>
    <div class="overflow-x-auto">
      <table class="min-w-full text-xs md:text-sm">
        <thead class="bg-black/40 text-gray-300">
          <tr>
            <th class="px-3 py-2 text-left">Nome</th>
            <th class="px-3 py-2 text-left">SKU</th>
            <th class="px-3 py-2 text-right">Estoque</th>
            <th class="px-3 py-2 text-right">Mín.</th>
            <th class="px-3 py-2 text-right">Venda</th>
            <th class="px-3 py-2 text-right">Custo</th>
            <th class="px-3 py-2 text-right">Repasse</th>
            <th class="px-3 py-2 text-center">Tipo</th>
            <th class="px-3 py-2 text-right"></th>
          </tr>
        </thead>
        <tbody>
          {% for r in rows %}
          <tr class="border-t border-zinc-800 hover:bg-black/40">
            <td class="px-3 py-2">{{ r.name }}</td>
            <td class="px-3 py-2">{{ r.sku or '-' }}</td>
            <td class="px-3 py-2 text-right">{{ r.stock }}</td>
            <td class="px-3 py-2 text-right">{{ r.min_stock }}</td>
            <td class="px-3 py-2 text-right">{{ r.price|money }}</td>
            <td class="px-3 py-2 text-right">{{ (r.cost_price or 0)|money }}</td>
            <td class="px-3 py-2 text-right">{{ (r.repasse_value or 0)|money }}</td>
            <td class="px-3 py-2 text-center">
              {% if r.is_labor %}
                <span class="px-2 py-0.5 rounded-full bg-amber-500/20 text-amber-300 text-[10px]">
                  Mão de obra
                </span>
              {% else %}
                <span class="px-2 py-0.5 rounded-full bg-sky-500/20 text-sky-300 text-[10px]">
                  Peça
                </span>
              {% endif %}
            </td>
            <td class="px-3 py-2 text-right">
              <a href="{{ url_for('estoque_editar', item_id=r.id) }}"
                 class="inline-flex items-center px-3 py-1 rounded-lg bg-zinc-700 hover:bg-zinc-600 text-[11px]">
                Editar
              </a>
            </td>
          </tr>
          {% endfor %}
          {% if rows|length == 0 %}
          <tr>
            <td colspan="9" class="px-3 py-4 text-center text-xs text-gray-500">
              Nenhum item cadastrado.
            </td>
          </tr>
          {% endif %}
        </tbody>
      </table>
    </div>
  </div>
</div>
{% endblock %}
