{% extends "base.html" %}
{% block body %}
<div class="max-w-6xl mx-auto py-6 text-gray-100">
  <div class="flex items-center justify-between mb-4">
    <div>
      <h1 class="text-2xl font-semibold">Detalhes do lançamento</h1>
      <div class="text-xs text-zinc-400">#{{ tx.id }} • {{ tx.date }} • {{ 'Entrada' if tx.ttype=='IN' else 'Saída' }}</div>
    </div>
    <div class="flex gap-2">
      <a href="{{ url_for('financeiro_lancamentos') }}" class="px-3 py-2 rounded-xl bg-black/40 border border-zinc-800 text-sm hover:bg-black/55">Voltar</a>
      <a href="{{ url_for('financeiro_editar', tx_id=tx.id) }}" class="px-3 py-2 rounded-xl bg-red-500 hover:bg-red-600 text-sm font-semibold">Editar</a>
    </div>
  </div>

  <div class="rounded-2xl bg-black/40 border border-zinc-800 p-4 mb-6">
    <div class="grid md:grid-cols-4 gap-3 text-sm">
      <div>
        <div class="text-xs text-zinc-400">Descrição</div>
        <div class="font-semibold">{{ tx.description }}</div>
      </div>
      <div>
        <div class="text-xs text-zinc-400">Categoria</div>
        <div>{{ tx.cat_name or '-' }}</div>
      </div>
      <div>
        <div class="text-xs text-zinc-400">Pagamento</div>
        <div>{{ tx.pm_name or '-' }}</div>
      </div>
      <div class="text-right">
        <div class="text-xs text-zinc-400">Valor</div>
        <div class="text-lg font-bold">{{ tx.amount|money }}</div>
        <div class="text-xs {% if tx.status=='EFETIVADO' %}text-emerald-300{% elif tx.status=='CANCELADO' %}text-zinc-400{% else %}text-amber-300{% endif %}">{{ tx.status }}</div>
      </div>
    </div>
  </div>

  <div class="grid lg:grid-cols-2 gap-6">
    <div class="rounded-2xl bg-black/40 border border-zinc-800 p-4">
      <div class="flex items-center justify-between mb-2">
        <h2 class="text-lg font-semibold">Detalhamento financeiro</h2>
        <div class="text-xs text-zinc-400">Entradas: {{ sum_money_in|money }} • Saídas: {{ sum_money_out|money }}</div>
      </div>

      {% if money_in %}
      <div class="text-xs text-zinc-400 mb-2">O que entrou (receitas)</div>
      <div class="overflow-x-auto mb-4">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-left text-zinc-400">
              <th class="py-2">Item</th>
              <th class="text-right">Qtd</th>
              <th class="text-right">Unit</th>
              <th class="text-right">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for it in money_in %}
            <tr class="border-t border-zinc-800">
              <td class="py-2">{{ it.description }}</td>
              <td class="text-right">{{ '%.2f'|format(it.qty) }}</td>
              <td class="text-right">{{ it.unit_value|money }}</td>
              <td class="text-right font-semibold">{{ it.total|money }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      {% if money_out %}
      <div class="text-xs text-zinc-400 mb-2">O que saiu (despesas)</div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-left text-zinc-400">
              <th class="py-2">Item</th>
              <th class="text-right">Qtd</th>
              <th class="text-right">Unit</th>
              <th class="text-right">Total</th>
            </tr>
          </thead>
          <tbody>
            {% for it in money_out %}
            <tr class="border-t border-zinc-800">
              <td class="py-2">{{ it.description }}</td>
              <td class="text-right">{{ '%.2f'|format(it.qty) }}</td>
              <td class="text-right">{{ it.unit_value|money }}</td>
              <td class="text-right font-semibold">{{ it.total|money }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      {% if not money_in and not money_out %}
      <div class="text-sm text-zinc-400">Sem itens detalhados neste lançamento.</div>
      {% endif %}
    </div>

    <div class="rounded-2xl bg-black/40 border border-zinc-800 p-4">
      <h2 class="text-lg font-semibold mb-2">Movimentação de estoque</h2>

      {% if stock_in %}
      <div class="text-xs text-zinc-400 mb-2">O que entrou no estoque</div>
      <div class="overflow-x-auto mb-4">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-left text-zinc-400">
              <th class="py-2">Peça</th>
              <th class="text-right">Qtd</th>
            </tr>
          </thead>
          <tbody>
            {% for it in stock_in %}
            <tr class="border-t border-zinc-800">
              <td class="py-2">{{ it.inv_name or it.description }}</td>
              <td class="text-right">{{ '%.2f'|format(it.qty) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      {% if stock_out %}
      <div class="text-xs text-zinc-400 mb-2">O que saiu do estoque</div>
      <div class="overflow-x-auto">
        <table class="w-full text-sm">
          <thead>
            <tr class="text-left text-zinc-400">
              <th class="py-2">Peça</th>
              <th class="text-right">Qtd</th>
            </tr>
          </thead>
          <tbody>
            {% for it in stock_out %}
            <tr class="border-t border-zinc-800">
              <td class="py-2">{{ it.inv_name or it.description }}</td>
              <td class="text-right">{{ '%.2f'|format(it.qty) }}</td>
            </tr>
            {% endfor %}
          </tbody>
        </table>
      </div>
      {% endif %}

      {% if not stock_in and not stock_out %}
      <div class="text-sm text-zinc-400">Sem movimentação de estoque vinculada.</div>
      {% endif %}
    </div>
  </div>

</div>
{% endblock %}
